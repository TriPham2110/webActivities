(()=>{console.log("This is background service worker - edit me!");let r=0;function e(r,e){chrome.storage.local.set({[r]:e})}function o(r,e){chrome.storage.local.get([r],(function(o){e(o[r])}))}function t(){return document.referrer}chrome.runtime.onInstalled.addListener((function(r){"install"===r.reason?chrome.tabs.query({currentWindow:!0},(function(r){1===r.length&&"chrome://extensions/"===r[0].url?chrome.tabs.create({url:"chrome://newtab"}):chrome.windows.create({url:"chrome://newtab"})})):chrome.storage.local.clear()})),chrome.tabs.onActivated.addListener((function(e){r=e.tabId})),chrome.storage.onChanged.addListener((function(r,e){for(let[e,{oldValue:o,newValue:t}]of Object.entries(r))console.log(e,o,t)})),chrome.tabs.onUpdated.addListener((function(n,c,l){"complete"===c.status&&chrome.scripting.executeScript({target:{tabId:n},func:t},(function(t){var c=chrome.runtime.lastError;void 0!==c&&console.log(n,c),console.log(t),o(n.toString(),(function(t){var c,i;void 0===t?r===n?(c=n,i=function(r){r.openerTabId?o(r.openerTabId.toString(),(function(o){e(n.toString(),void 0!==o?{curUrl:r.url,prevUrl:o.curUrl,prevTabId:r.openerTabId}:{curUrl:r.url,prevUrl:"",prevTabId:n})})):e(n.toString(),{curUrl:r.url,prevUrl:"",prevTabId:n})},chrome.tabs.query({currentWindow:!0},(function(r){for(var e=0;e<r.length;e++)r[e].id==c&&i(r[e])}))):o(r.toString(),(function(o){void 0!==o&&e(n.toString(),{curUrl:l.url,prevUrl:o.curUrl,prevTabId:r})})):(t.prevUrl=t.curUrl,t.curUrl=l.url,t.prevTabId=l.id,e(n.toString(),t))}))}))}))})();